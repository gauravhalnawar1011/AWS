# Malware Protection Using an AWS Network Firewall Lab

## Lab Overview

Malware, short for malicious software, poses a significant threat to data and computer systems. This lab focuses on countering malware threats using AWS Network Firewall, a service that provides scalable network security for your Amazon VPC.

### Scenario

As a new security engineer at AnyCompany, your task is to enhance the company's security perimeter. Users have inadvertently downloaded malware from specific websites, and your goal is to mitigate access to these malicious files using AWS Network Firewall.

### Objectives

After completing this lab, you should be able to:

1. Update a network firewall
2. Create a firewall rules group
3. Verify and test that access to malicious sites is blocked

**Duration:** Approximately 45 minutes

## Lab Environment

- Pre-configured TestInstance (Amazon EC2) in a perimeter zone
- AWS Network Firewall with backend components pre-built
- Access to AWS Management Console provided through the lab interface

**Note:** Do not change the lab Region unless instructed.

## Accessing the AWS Management Console

1. Click **Start Lab** at the upper-right corner.
2. Wait for the lab to be ready (indicated by a green circle).
3. Click the AWS icon at the top to open the AWS Management Console.

## Task 1: Confirm Reachability

In this task, you confirm the accessibility of URLs hosting malware files.

1. Click **AWS Details** on the Vocareum console.
2. Copy the link next to TestInstanceURL.
3. Open a new tab, paste the link, and navigate to the TestInstance.
4. Run wget commands to download malicious files.
![image](https://github.com/gauravhalnawar1011/AWS/assets/140076717/9430bbdc-5a46-47fb-a086-56b967b27538)
![image](https://github.com/gauravhalnawar1011/AWS/assets/140076717/7c9cc242-82b2-4691-b9f2-1b4a29a43757)

**Note:** These files are for testing purposes only within the lab environment.

## Task 2: Inspect the Network Firewall

1. In the AWS Management Console, go to **VPC** > **Firewalls** > **LabFirewall**.
2. In **Step 2: Configure the firewall policy**, edit **Stateless default actions** to forward to stateful rule groups.
![image](https://github.com/gauravhalnawar1011/AWS/assets/140076717/dd816ba4-13b9-4617-b18c-489ecbc8a90f)

## Task 3: Create a Firewall Rule Group

1. In **NETWORK FIREWALL**, go to **Network Firewall Rule Groups**.
2. Click **Create Network Firewall rule group**.
3. Configure a stateful rule group named "StatefulRuleGroup" with Suricata rules to block malicious URLs.
4. Create the rule group.
![image](https://github.com/gauravhalnawar1011/AWS/assets/140076717/1338fa9c-90f5-43b4-99a8-7a212c90941c)
![image](https://github.com/gauravhalnawar1011/AWS/assets/140076717/05e82958-d373-4905-b432-d3973608eb6c)

## Task 4: Attach a Rule Group to the Network Firewall

1. In **NETWORK FIREWALL**, go to **Firewalls** > **LabFirewall**.
2. Under **Step 2**, add the created rule group "StatefulRuleGroup".
![image](https://github.com/gauravhalnawar1011/AWS/assets/140076717/daf1b9a6-5e32-4945-bf91-e8f2e16678b9)

## Task 5: Validate the Solution

1. In the AWS Management Console, go to **EC2** > **Instances**.
2. Connect to the TestInstance using Session Manager.
3. Run wget commands to test access to malicious files.
![image](https://github.com/gauravhalnawar1011/AWS/assets/140076717/d62ec9db-4efb-4dfc-a496-7535fe6ea938)
![image](https://github.com/gauravhalnawar1011/AWS/assets/140076717/b485fa87-d5de-4d41-b11a-46ceb314ceb7)
![image](https://github.com/gauravhalnawar1011/AWS/assets/140076717/ffc3f9e4-0a5e-4fc5-8bc9-dd7302151d14)

## Conclusion

Congratulations! You have successfully:

- Updated a network firewall
- Created a firewall rules group
- Verified and tested that access to malicious sites is blocked

## Lab Complete

Click **End Lab** at the top, and confirm with **Yes**. Ensure you see the "Ended AWS Lab Successfully" message.

For more information about AWS Training and Certification, visit [AWS Training and Certification](https://www.aws.training/).

Your feedback is valuable; share suggestions or corrections in the [AWS Training and Certification Contact Form](https://www.aws.training/Support).

Â© 2022 Amazon Web Services, Inc. All rights reserved. Commercial copying, lending, or selling is prohibited.
